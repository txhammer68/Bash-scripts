#!/bin/bash
start=`date +%s` > /dev/null
titles=(
"Guardians of the Galaxy"
"Hackers"
"Halloween"
"Halloween II"
"Hancock"
)
urlList=(
"https://g.pollllop.com/_v11/d962cd029fd0c2e86cff83c14afbbf52bddcba837d9b85b29f40bce8cf62c8cea59518ae087f88e7a15c8090074d541960280558979ae2e4dd2ba70e22344a73eda7813d2dcd5100ab00007fe62f72d73d2eba5c663b256fe7283d3e7c440d5bd03e0bab5b716ae25a2e043a278a339816df6cc6feeef9f67b90ecb7f9cdc75ab5be074d23dcbbc6bf19633b5d6276f0/1080/index.m3u8"
"https://o.pollllop.com/_v11/af53437d39045647fd35e42764b87fe03b6ccfc4c7ec3974bbdcf2636bac6bcfed0ce51f4890769fff7ab86fb13f8334047f6cd3470291c70d8b2a3f2cb5cd0663e59d2189c29ca222c523058581af3c6b9c6da34fa5c7c2179ebd6a5dafaac4278d89ebd470f5ba6834c553d04771e8c2c37634b34878a0531a0756e1032c2a/720/index.m3u8"
"https://v.pollllop.com/_v11/6ab8747ad8d56e6c35d85085b330207dfb2eb741f405bd66562eeb5709ec66cdc17ffa7c3ba4f7daf03af0230bf6a001151aa52556f05c0f780328f8c4354d0b5de097bd5168c246ba979d4927fa11d90dae9f90930d1e4c319fac6ecf47e1aa773693794a5bba9e584e01cc9b30c8cc13d521f72645b056114e0aa572529933fb596578f87468b1534a003dfb658d51/1080/index.m3u8"
"https://j.pollllop.com/_v11/9996b69c285782489d4eee149cd8c3e93d9e751443c5f54efdad2d21049cdc019676e1e715a97973cdfd6fb13372575874ae199f80a520403850f74ec165495389b8b5318dc05e42b8fdcba6b553dab982a08dbce8770334c1dd9eab1fc49158bb1a614971f22ce80216470b41c99339b46ecabbffe9005a65b3680e8c8873f682c7d0de5a594621a25657d97410c436/1080/index.m3u8"
"https://f.pollllop.com/_v11/fcd6be6de9c6543425d71c3d49ce6f8947f57ba88ca452f9c151ac409652f358ec3d5bd563ad8ad15a90e9a58b8d7e5d450371e07e6ac72311a2c04b78b61c01b1ff7ffff461aaf9a75070dc4a15d3a97e078bf988f5fbe3257554dfaccbb5e6e08b1d0771204607e107db5b8ee7f6ff1f2f9c9cb527e27ac5597a90adc341bf219e171a597286f17cd33600b8b46f89/1080/index.m3u8"
)
url=""
mediaTitle=""
length=${#urlList[@]}
errorCnt=0
completedList=()
abortedList=()

trap ctrl_c INT

function ctrl_c () {
    kill -9 $appID >/dev/null
    ps -ef | grep movies | awk '{print $2}' | xargs kill -- >/dev/null
}

function sleepMode () {
    while /bin/true; do qdbus org.freedesktop.ScreenSaver /ScreenSaver SimulateUserActivity ; sleep 5m; done
}

function getMovie () {
        while ! yt-dlp $url -q --progress -c --no-warnings --force-ipv4 --no-check-certificates --impersonate="" --socket-timeout 5 --concurrent-fragments 4 --http-chunk-size 220K --abort-on-unavailable-fragments --retry-sleep 5 --format mp4 -o "/tmp/$mediaTitle.mp4"; do
            ((errorCnt++));
            if (( errorCnt > 25)); then
                abortedList+=("$mediaTitle");
                break;
            else
                echo "Errors, Restarting";
                sleep 5;
            fi
        done;
        if ffmpeg -v quiet -y -i "/tmp/$mediaTitle.mp4" -metadata title="$mediaTitle" -codec copy "/home/data/Movies/$mediaTitle.mp4"; then
            rm "/tmp/$mediaTitle.mp4";
            completedList+=("$mediaTitle");
        fi
}

sleepMode &
appID=$!
for (( i=0; i < ${length}; i++ )) do
    url="${urlList[$i]}";
    mediaTitle="${titles[$i]}";
    errorCnt=0;
    getMovie;
done
ftime=`date`
echo " "
echo "****************************************************************************"
echo "Duration: $((($(date +%s)-$start)/60)) minutes"
echo "Completed Downloads: $ftime"
printf '%s\n' "${completedList[@]}"
echo " "
echo "Aborted Downloads: "
printf '%s\n' "${abortedList[@]}"
echo "****************************************************************************"
ctrl_c
